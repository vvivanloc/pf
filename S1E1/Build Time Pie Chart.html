<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title></title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@hpcc-js/observablehq-compiler/dist/index.css">
  <script src="https://cdn.jsdelivr.net/npm/@observablehq/runtime/dist/runtime.umd.js" type="text/javascript" charset="utf-8"></script>
  <script src="https://cdn.jsdelivr.net/npm/@hpcc-js/observablehq-compiler/dist/index.min.js" type="text/javascript" charset="utf-8"></script>
  <script>
    var compilerMod = window["@hpcc-js/observablehq-compiler"]
  </script>
</head>

<body>
  <div id="placeholder" class="observablehq-root">
  </div>
  <script type="module">
    const notebook = {
    "files": [],
    "nodes": [
        {
            "id": 0,
            "mode": "js",
            "value": "md`\n# Build Time Pie Chart\n`;",
            "start": 0,
            "end": 29
        },
        {
            "id": 1,
            "mode": "js",
            "value": "data = d3.csvParse(\n  `name,value\na, 60\nb, 60\nc, 180\nd, 1020\ne, 46\nf, 420\ng, 186\nh, 36\ni, 22\nj, 340\n`,\n  d3.autoType\n);",
            "start": 31,
            "end": 150
        },
        {
            "id": 2,
            "mode": "js",
            "value": "midAngle = function (startAngle, endAngle) {\n  return startAngle + (endAngle - startAngle) / 2;\n};",
            "start": 180,
            "end": 278
        },
        {
            "id": 3,
            "mode": "js",
            "value": "color = d3\n  .scaleOrdinal()\n  .domain(data.map((d) => d.name))\n  .range(\n    d3\n      .quantize((t) => d3.interpolateSpectral(t * 0.8 + 0.1), data.length)\n      .reverse()\n  );",
            "start": 280,
            "end": 457
        },
        {
            "id": 4,
            "mode": "js",
            "value": "mode = Generators.observe((notify) => {\n  const query = matchMedia(\"(prefers-color-scheme: dark)\");\n  const changed = () => notify(query.matches ? \"dark\" : \"light\");\n  changed();\n  query.addListener(changed);\n  return () => query.removeListener(changed);\n});",
            "start": 459,
            "end": 717
        },
        {
            "id": 5,
            "mode": "js",
            "value": "MyWSJPieSorting = function (myArray) {\n  let WSJproportion = [myArray[0]]\n    .concat(myArray.slice(2).reverse())\n    .concat(myArray[1]);\n  return WSJproportion;\n};",
            "start": 763,
            "end": 928
        },
        {
            "id": 6,
            "mode": "js",
            "value": "chart = {\n  const pie = d3\n    .pie()\n    .sort(null)\n    .value((d) => d.value);\n\n  const _data = MyWSJPieSorting(data);\n  const arcs = pie(_data);\n  // const arcs = pie((data));\n\n  const height = Math.min(width, 400);\n\n  const isOnLeftSide = (d) => midAngle(d.startAngle, d.endAngle) < Math.PI;\n  const fontSize = 15;\n  const buildLabel = (d) =>\n    `${d.data.name}: ${d.data.value.toLocaleString(\"fr-FR\")}`;\n\n  const svg = d3\n    .create(\"svg\")\n    .attr(\"viewBox\", [-width / 2, -height / 2, width, height]);\n\n  const radius = Math.min(width, height) / 2;\n\n  const donut = false;\n  var innerArc = d3\n    .arc()\n    .outerRadius(radius * 0.8)\n    .innerRadius(radius * donut ? 0.4 : 0.0);\n  var outerArc = d3\n    .arc()\n    .innerRadius(radius * 0.9)\n    .outerRadius(radius * 0.9);\n\n  /* ----- total ------ */\n  svg\n    .append(\"g\")\n    .attr(\"font-family\", \"sans-serif\")\n    .attr(\"font-size\", 24)\n    .attr(\"text-anchor\", \"middle\")\n    .attr(\"fill\", mode === \"dark\" ? \"white\" : \"lightsteelblue\")\n    .append(\"text\")\n\n    .call((text) =>\n      text\n        .append(\"tspan\")\n        .attr(\"y\", \"-0.4em\")\n        .attr(\"font-weight\", \"bold\")\n        .text(\"total\")\n    )\n    .call((text) =>\n      text\n        .append(\"tspan\")\n        .attr(\"x\", 0)\n        .attr(\"y\", \"0.9em\")\n        .attr(\"font-weight\", \"bold\")\n        .text(d3.sum(data, (d) => d.value).toLocaleString(\"fr-FR\"))\n    );\n\n  /* ------- pie slices -------*/\n  svg\n    .append(\"g\")\n    .attr(\"fill\", mode === \"dark\" ? \"white\" : \"lightsteelblue\")\n    .selectAll(\"path\")\n    .data(arcs)\n    .join(\"path\")\n    .attr(\"fill\", (d) => color(d.data.name))\n    .attr(\"d\", innerArc);\n  /* ------- text labels inside -------*/\n  svg\n    .append(\"g\")\n    .attr(\"font-size\", fontSize)\n    .selectAll(\"text\")\n    .data(arcs)\n    .join(\"text\")\n    .attr(\"transform\", function (d) {\n      var pos = innerArc.centroid(d);\n      pos[0] = pos[0] - (fontSize * 0.75 * buildLabel(d).length) / 2;\n      return `translate(${pos})`;\n    })\n\n    .attr(\"fill\", mode === \"dark\" ? \"white\" : \"lightsteelblue\")\n    .text((d) => buildLabel(d));\n\n  /* ------- text labels outside -------*/\n  svg\n    .append(\"g\")\n    .attr(\"font-size\", fontSize)\n    .selectAll(\"text\")\n    .data(arcs)\n    .join(\"text\")\n    .attr(\"transform\", function (d) {\n      var pos = outerArc.centroid(d);\n      pos[0] = radius * (isOnLeftSide(d) ? 1 : -1);\n      pos[1] = pos[1] + fontSize * 0.3;\n      return `translate(${pos})`;\n    })\n    .attr(\"text-anchor\", (d) => (isOnLeftSide(d) ? \"start\" : \"end\"))\n    .attr(\"fill\", mode === \"dark\" ? \"white\" : \"lightsteelblue\")\n    .text((d) => buildLabel(d));\n\n  /* ------- slice to text polylines -------*/\n  svg\n    .append(\"g\")\n    .selectAll(\"polyline\")\n    .data(arcs)\n    .join(\"polyline\")\n    .attr(\"opacity\", \".3\")\n    .attr(\"stroke\", mode === \"dark\" ? \"white\" : \"lightsteelblue\")\n    .attr(\"stroke-width\", \"2px\")\n    .attr(\"fill\", \"none\")\n    .attr(\"points\", function (d) {\n      var pos = outerArc.centroid(d);\n      pos[0] = radius * 0.95 * (isOnLeftSide(d) ? 1 : -1);\n      return [innerArc.centroid(d), outerArc.centroid(d), pos];\n    });\n\n  return svg.node();\n}",
            "start": 930,
            "end": 4058
        },
        {
            "id": 7,
            "mode": "js",
            "value": "d3 = require(\"d3@5\");",
            "start": 4062,
            "end": 4083
        }
    ]
};
    const placeholder = document.getElementById("placeholder");
    const compiledNB = await compilerMod.compile(notebook);
    const library = new observablehq.Library();
    const runtime = new observablehq.Runtime(library);
    compiledNB(runtime, name => {
      const div = document.createElement("div");
      placeholder.appendChild(div);
      return new observablehq.Inspector(div);
    });
  </script>
</body>

</html>
